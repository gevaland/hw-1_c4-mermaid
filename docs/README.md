# ML System Design Doc
## Дизайн ML системы - \<Сервис подбора каналов для рекламы в телеграм\>
 

### 1. Цели и предпосылки 
#### 1.1. Цель разработки продукта  

- Бизнес-цель — создание продукта, позволяющего автоматизировать подбор наиболее качественных каналов для размещения рекламы в телеграм.

- Почему станет лучше, чем сейчас, от использования ML: сейчас при выборе каналов для размещения рекламы рекламодателю необходимо провести аналитику каналов на предмет качества и соответствия тематики. С использованием нашего сервиса этот процесс будет автоматизирован и будет занимать меньше времени.

- С точки зрения бизнеса, успехом в текущей итерации будем считать создание MVP нашего сервиса. Планируем реализовать функционал подбора телеграмм каналов для размещения поста пользователя.

#### 1.2. Бизнес-требования и ограничения  

##### Краткое описание бизнес-требований:

- Основное назначение продукта — помощь рекламодателям в подборе наиболее релевантных телеграм-каналов для размещения рекламы на основе их запросов и потребностей.
- Целевая аудитория: рекламодатели, бренды, маркетологи и рекламные агентства, желающие эффективно разместить рекламу в телеграме.
- Входные данные: запросы или критерии от рекламодателя (например, целевая аудитория, тематика, размер аудитории канала); история размещения рекламы рекламодателем (если доступна).
- Ключевые функции: 
    - анализ и классификация телеграм-каналов по различным параметрам; 
    - сопоставление запросов рекламодателей с подходящими телеграм-каналами; 
    - рейтинговая система для телеграм-каналов на основе обратной связи от рекламодателей, эффективности рекламных кампаний, алгоритмов оценки канала по различным метрикам.
- Ключевые метрики эффективности: 
    - процент успешных рекомендаций: цель - достичь 85% успешных рекомендаций, где успех определяется как размещение рекламы, которое привело к увеличению охвата аудитории на не менее чем 15% по сравнению с предыдущими кампаниями; 
    - ROI: цель - достичь минимального уровня ROI в 120% от проведённых рекламных кампаний на рекомендованных каналах; 
    - уровень удовлетворённости рекламодателей: измеряется по 5-балльной шкале, где цель - достичь среднего балла не менее 4,5 на основе обратной связи рекламодателей.
- Масштабируемость: способность продукта адаптироваться к увеличению объема данных и числа пользователей.

#### 1.3. Пилот

##### Что мы ожидаем от конкретной итерации:

- Завершение задач: основное ожидание от любой итерации — это завершение определенного списка задач или функций, которые были определены на начало итерации.
- Тестирование: проверка новых функций на ошибки или проблемы. На этом этапе важно убедиться, что все работает корректно и соответствует требованиям.
- Обратная связь: получение отзывов от ключевых заинтересованных сторон или бета-тестеров о новых функциях или изменениях.
- Оценка прогресса: оценка того, насколько команда приблизилась к завершению целей проекта или к достижению ключевых показателей эффективности.
- Адаптация: внесение необходимых изменений в план или стратегию на основе результатов итерации и полученной обратной связи.
- Оценка производительности команды: анализ работы команды, выявление проблем и обсуждение возможных улучшений для следующих итераций.
- Документация: обновление технической документации, руководств пользователя и других необходимых материалов на основе проведенной работы.
- Рефлексия: обсуждение успехов и проблем текущей итерации с командой, чтобы выявить уроки и улучшения для будущих этапов.
- Планирование следующей итерации: определение приоритетных задач и функций для следующего этапа разработки на основе результатов текущей итерации.
- Доставка или релиз: если итерация заключается в выпуске новой версии продукта или функции, ожидается успешная доставка этого релиза пользователям или клиентам.

##### Бизнес-процесс пилота:

- Целевая аудитория пилота: 
    - выбирается небольшая группа рекламодателей, проявляющих интерес к новому продукту и готовых участвовать в пилоте; 
    - избирается набор телеграм-каналов для участия в пилоте.
- Сбор данных: 
    - производится сбор и анализ данных о выбранных телеграм-каналах; 
    - от рекламодателей запрашивается информация о их целевой аудитории, бюджете и другие необходимые параметры.
- Интеграция модели: 
    - рекомендательная модель интегрируется в рабочую среду; 
    - подключаются необходимые системы и инструменты для обработки данных.
- Тестирование и оптимизация: 
    - модель запускается и производит рекомендации для рекламодателей; 
    - производится анализ результатов и оптимизация модели на основе выявленных неточностей.
- Получение обратной связи: 
    - рекламодатели осуществляют рекламные кампании на рекомендованных каналах; 
    - собирается обратная связь от рекламодателей о качестве рекомендаций и результативности кампаний.
- Анализ результатов: проводится анализ результатов пилота, оценивается успешность рекламных кампаний и другие ключевые показатели.
- Внесение корректировок: на основе полученных результатов и обратной связи вносятся изменения в модель и процесс работы.
- Масштабирование: в случае успешного пилота происходит масштабирование модели с расширением участников и телеграм-каналов.
- Документация и отчетность: готовится документация по результатам пилота, включая отчеты, анализы и рекомендации.

#### 1.4. Критерии успеха и возможные пути развития проекта:

##### Критерии успеха:

- Точность рекомендаций: достижение согласованности между рекомендациями и запросами рекламодателей на уровне не менее 90%.
- Рост конверсии: увеличение конверсии рекламных кампаний на рекомендованных каналах на 20% по сравнению с базовыми показателями.
- Повышение уровня удовлетворенности: более 80% отзывов имеют оценку 5 баллов.
- Экономическая эффективность: достижение ROI на уровне 120% и выше.
- Техническая стабильность: менее 2% отказов или сбоев в работе системы в течение первых 6 месяцев эксплуатации.
- Скорость и масштабируемость: обработка запросов в режиме реального времени с возможностью масштабирования системы для обработки в 2 раза большего объема данных без снижения производительности.

##### Возможные пути развития проекта:

- Расширение базы данных: добавление большего количества телеграм-каналов и категорий для более точной и разнообразной рекомендации.
- Интеграция с другими платформами: расширение функционала системы для включения рекомендаций не только телеграм-каналов, но и других социальных платформ или медиа.
- Улучшение алгоритмов: основываясь на данных и обратной связи от пользователей, оптимизировать и усовершенствовать алгоритмы рекомендации.
- Внедрение дополнительных аналитических инструментов: предоставление рекламодателям детальной аналитики о рекламных кампаниях, аудитории каналов и прочем.
- Персонализация интерфейса: разработка индивидуальных настроек и функционала для каждого рекламодателя на основе его предпочтений и истории запросов.
- Партнерства и интеграции: сотрудничество с платформами, агентствами и другими участниками рынка для увеличения привлекаемой аудитории и расширения возможностей проекта.

### 2. Архитектура решения

#### 2.1 Сценарий использования

<img src="./uml-usecases.svg" alt="uml-usecases">

#### 2.2 C4 context

<img src="./c4-context.svg" alt="c4-context">

#### 2.3 C4 containers

<img src="./c4-containers.svg" alt="c4-containers">

#### 2.4 C4 containers

[![](https://mermaid.ink/img/pako:eNqtWN1P21YU_1csqw9UClVcEgiR9lA-tkrVJla2aZ0iIce-FERiZ44zwSqkQNWxiW3Vnlb1Yd0qTXtNgWwuH8m_cP0f7Zxz_Rn7gpeBBNwcn3vO73wf55lq2CZT6-pyZdlud2yLWW7DcrfdFlP4az7il3wMf6_4kF_5h_B_4L9UgDjiZ0C68H9U4HABtIe6adsdhXvKI31zR29YDWuNOV3bmul1mVNSGip_A7fgBv8H_p-AoEMhoaHS01f-AakiDv85H_qHimCB31O_zwf8cpa_4yOgBzoD_uf-EcLjHpCAb8jPCTeSzkDNd9zj74k3fHqBssCeY36pwMcBmiWIDfVuw1rf67qsvbG66864TzeMLd2yWKtLIN-m8aCLgtv-cWwHwB4BJkDEzxErsoA2_0UEPFTpgTMG6DQZbgLUsJbsnmXqzt5MUwtcOYQbHnL7h35fAd95pHfILxHJXeVZw1LgZ9m2XH3bYs5GJGKLIoVigpitGnaXTE7cE3eDhJjZMjfJ_ocrH64ToizLnu5YyPLkweNPJCzdju7sIM86HiKmfTRQghUY4-wZ-H2wEwxPBg1SSQr76x7rsQ3d1DsuCI1lfYp05YGgS8AK7g0jJOC9NaIVAu4wA9KIgP-eiWyQ-EE1JWPHBwWNAfldIb-IMazdZKYpjF8NzvmsK82Zb5jh2s6G2UTuL-jDypKU29CNLYacy3go5Bsoqqbt5tfTL1jfUh-Im-mgfPaRsmS7EsPTTgu05nvsOsQ72NLwKvW2AgXTdOwd4e4lOknguXZn2yAj8CDLRMc2e4aQthacJayGbXV7bcG6HJxlxeg6TG93Y6PWBSHrj8esFfTwPPfzVzQYhhTAczh50NuvIN2HChygu1GXEuPiPaX5CVCGU7TwCBkCypanrNj5b6BzTPBOUKUYLAcg_x0RqTULQNGHlKp8wcmoFGBPRibFHj-QFTj_C9xyCOCGYvIlIMP4CMatHEEoSAo4bg6pyud_Bu7xUO0JxoTmWp-GFk3wm32XzZjciuS_wn2Kkf89JZAwVpIJ3kTyTG4UL6_xBiksGDvilQYu4ayoB_LX_k9oAQyqYIE5AlS0DyhUCxM24rCecF9oG5TEAdpOPhCFAU9GKAxkj2lQJLJIIJCl0GRM4p0mb8wVW2HGwTz24MnpBJys1HCD4H-A3Bcis6JaBLn9HEecKLhvRArPMNigCn3QD9CN8LMSCgw9lcISbB0RgOurKaUxbBG0dEIwvDzB6aLBRD6l8P8d6khLSdoX15R_jOZmhi35MkrWaFrwNyD_Ha2P50GiTXoOtI4pdc6CCRs-Q30QOw_NyekdsbZ4hMk7KJr2Q67Xw9vJ8uFv4e5VkdvxrYTNNETGtCsdhy0CzhAn2KPSdoU1dEQdIaqeKIklyqIFNZ0kYwrcKJScKIWo_6LLaastmjvh9E16OboBjSw2MRPaR2IZQUckX5hAaWqQI4cC5TEkl_cTTYnq5kSIk9mWl-nhip_7qoZ7f9y74nRJjXUI13NqGvj-5QXvPQOUNpGrFDBsmNjzj8TLm3hxE5sy2pKCKLBFRY5vrtg6z6g9JUxHswl62C3QCZGiknRnAdw_Q7J6EHX_QEm9B33eMXWXAYh1d6_FpKvSHZftust2y3Y-gK2wpRs7-MJ4pwWbZkhtRlR7c7PL3C-BNjtXKSdIT4hULsu0F92LpkQzCUWK46alaVpv1CYRXOOLm1araTFo1SndECqON65bc0NVCiF3vZva9HImGWtSzYWWvymRTBsC0nmr6VAtHorsyjh1HDIJMC8vg7zd8P_4XpvLFuHNNRhM8ml1lovrTG18t9ToZqs3qRMT6JbUyY1LDrpps-c_pGx2H7y91qFJtWa3x9vTKpTStxtqSQXhbX3bVOsqfY_TUN0t1mYNtQ5Hk23qvZYLr0_WPrDqPdde37MMte46PVZSe4R5ZVt_6uhttb6pt7pAZeY21PjH4kt1-m69pHZ0S60_U3fVerV2b2Fhvny_Nr-wWNEqlWpJ3VPrs7X5e9qipmmLiwvlOa1Snt8vqd_aNkjV7mnlxcp8eaFau1_R5hZrJO0reoYw9v8FEYVWgw?type=png)](https://mermaid.live/edit#pako:eNqtWN1P21YU_1csqw9UClVcEgiR9lA-tkrVJla2aZ0iIce-FERiZ44zwSqkQNWxiW3Vnlb1Yd0qTXtNgWwuH8m_cP0f7Zxz_Rn7gpeBBNwcn3vO73wf55lq2CZT6-pyZdlud2yLWW7DcrfdFlP4az7il3wMf6_4kF_5h_B_4L9UgDjiZ0C68H9U4HABtIe6adsdhXvKI31zR29YDWuNOV3bmul1mVNSGip_A7fgBv8H_p-AoEMhoaHS01f-AakiDv85H_qHimCB31O_zwf8cpa_4yOgBzoD_uf-EcLjHpCAb8jPCTeSzkDNd9zj74k3fHqBssCeY36pwMcBmiWIDfVuw1rf67qsvbG66864TzeMLd2yWKtLIN-m8aCLgtv-cWwHwB4BJkDEzxErsoA2_0UEPFTpgTMG6DQZbgLUsJbsnmXqzt5MUwtcOYQbHnL7h35fAd95pHfILxHJXeVZw1LgZ9m2XH3bYs5GJGKLIoVigpitGnaXTE7cE3eDhJjZMjfJ_ocrH64ToizLnu5YyPLkweNPJCzdju7sIM86HiKmfTRQghUY4-wZ-H2wEwxPBg1SSQr76x7rsQ3d1DsuCI1lfYp05YGgS8AK7g0jJOC9NaIVAu4wA9KIgP-eiWyQ-EE1JWPHBwWNAfldIb-IMazdZKYpjF8NzvmsK82Zb5jh2s6G2UTuL-jDypKU29CNLYacy3go5Bsoqqbt5tfTL1jfUh-Im-mgfPaRsmS7EsPTTgu05nvsOsQ72NLwKvW2AgXTdOwd4e4lOknguXZn2yAj8CDLRMc2e4aQthacJayGbXV7bcG6HJxlxeg6TG93Y6PWBSHrj8esFfTwPPfzVzQYhhTAczh50NuvIN2HChygu1GXEuPiPaX5CVCGU7TwCBkCypanrNj5b6BzTPBOUKUYLAcg_x0RqTULQNGHlKp8wcmoFGBPRibFHj-QFTj_C9xyCOCGYvIlIMP4CMatHEEoSAo4bg6pyud_Bu7xUO0JxoTmWp-GFk3wm32XzZjciuS_wn2Kkf89JZAwVpIJ3kTyTG4UL6_xBiksGDvilQYu4ayoB_LX_k9oAQyqYIE5AlS0DyhUCxM24rCecF9oG5TEAdpOPhCFAU9GKAxkj2lQJLJIIJCl0GRM4p0mb8wVW2HGwTz24MnpBJys1HCD4H-A3Bcis6JaBLn9HEecKLhvRArPMNigCn3QD9CN8LMSCgw9lcISbB0RgOurKaUxbBG0dEIwvDzB6aLBRD6l8P8d6khLSdoX15R_jOZmhi35MkrWaFrwNyD_Ha2P50GiTXoOtI4pdc6CCRs-Q30QOw_NyekdsbZ4hMk7KJr2Q67Xw9vJ8uFv4e5VkdvxrYTNNETGtCsdhy0CzhAn2KPSdoU1dEQdIaqeKIklyqIFNZ0kYwrcKJScKIWo_6LLaastmjvh9E16OboBjSw2MRPaR2IZQUckX5hAaWqQI4cC5TEkl_cTTYnq5kSIk9mWl-nhip_7qoZ7f9y74nRJjXUI13NqGvj-5QXvPQOUNpGrFDBsmNjzj8TLm3hxE5sy2pKCKLBFRY5vrtg6z6g9JUxHswl62C3QCZGiknRnAdw_Q7J6EHX_QEm9B33eMXWXAYh1d6_FpKvSHZftust2y3Y-gK2wpRs7-MJ4pwWbZkhtRlR7c7PL3C-BNjtXKSdIT4hULsu0F92LpkQzCUWK46alaVpv1CYRXOOLm1araTFo1SndECqON65bc0NVCiF3vZva9HImGWtSzYWWvymRTBsC0nmr6VAtHorsyjh1HDIJMC8vg7zd8P_4XpvLFuHNNRhM8ml1lovrTG18t9ToZqs3qRMT6JbUyY1LDrpps-c_pGx2H7y91qFJtWa3x9vTKpTStxtqSQXhbX3bVOsqfY_TUN0t1mYNtQ5Hk23qvZYLr0_WPrDqPdde37MMte46PVZSe4R5ZVt_6uhttb6pt7pAZeY21PjH4kt1-m69pHZ0S60_U3fVerV2b2Fhvny_Nr-wWNEqlWpJ3VPrs7X5e9qipmmLiwvlOa1Snt8vqd_aNkjV7mnlxcp8eaFau1_R5hZrJO0reoYw9v8FEYVWgw)

#### 2.5 Масштабируемость компонентов

HDFS (Hadoop Distributed File System)
HDFS разработан для хранения очень больших файлов с потоковым доступом к данным, работая на кластерах из обычного оборудования. Масштабирование HDFS достигается за счет:

* Горизонтальное масштабирование: Добавление новых узлов (нод) в кластер HDFS позволяет линейно увеличивать его хранилище и пропускную способность без прерывания работы сервиса.
* Репликация данных: HDFS автоматически реплицирует данные на несколько узлов для обеспечения высокой доступности и устойчивости к отказам. Параметры репликации можно настроить в зависимости от критичности данных.
* Разбиение файлов: Большие файлы разбиваются на блоки данных, которые распределяются по разным узлам, позволяя системе параллельно обрабатывать запросы и оптимизировать использование ресурсов.

Spark
Apache Spark предлагает распределенную обработку данных и способен обрабатывать задачи, требующие большой вычислительной мощности, через:

* In-memory вычисления: Spark может хранить промежуточные данные в памяти (а не на диске, как Hadoop MapReduce), что значительно ускоряет обработку повторяющихся запросов и итеративных алгоритмов.
* Горизонтальное масштабирование: Как и HDFS, Spark легко масштабируется путем добавления узлов в кластер. Это увеличивает вычислительные ресурсы и позволяет параллельно обрабатывать большие объемы данных.
* Распределенное выполнение задач: Spark автоматически распределяет данные и задачи по узлам кластера, оптимизируя выполнение и минимизируя передачу данных.

Kafka
Apache Kafka — это распределенная система публикации и подписки, предназначенная для обработки потоковых данных. Масштабирование Kafka достигается за счет:

* Топики и партиции: Kafka разбивает данные на топики, которые в свою очередь делятся на партиции. Партиции могут быть распределены и реплицированы по узлам кластера, что обеспечивает параллельную обработку и высокую доступность.
* Горизонтальное масштабирование: Добавление брокеров (узлов Kafka) увеличивает пропускную способность и надежность системы. Каждый новый брокер может обрабатывать дополнительные партиции, распределяя нагрузку.
* Балансировка нагрузки: Kafka автоматически управляет нагрузкой между брокерами, перераспределяя партиции при изменении конфигурации кластера, чтобы обеспечить равномерное использование ресурсов.

Масштабирование этих компонентов позволяет системе адаптироваться к растущим объемам данных и запросам, обеспечивая высокую производительность, надежность и доступность.
